<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>Write a Driving Routine</TITLE>
<META NAME="description" CONTENT="Write a Driving Routine">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="manual.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html200" HREF="node18.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="/figs/next_motif.gif"></A> <A NAME="tex2html198" HREF="node10.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="/figs/up_motif.gif"></A> <A NAME="tex2html194" HREF="node16.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="/figs/previous_motif.gif"></A>   <BR>
<B> Next:</B> <A NAME="tex2html201" HREF="node18.html">Appendix A: Taylor Grammar</A>
<B>Up:</B> <A NAME="tex2html199" HREF="node10.html">User's guide</A>
<B> Previous:</B> <A NAME="tex2html195" HREF="node16.html">The Fortran 77 wrapper</A>
<BR> <P>
<H2><A NAME="SECTION00054000000000000000">Write a Driving Routine</A></H2>
<P>
The main driving routine produced by the <TT>-main</TT>
flag of <B>taylor</B>
is rather simple, it just keeps on integrating the 
system and print out the solution along the way.
This may be enough for some tasks, but it is
definitely too primitive for real applications.
In this section, we provide two sample
driving routines.  These examples demonstrate
what you need to do to write your own driving
routes. The input files are provided in the doc
subdirectory in the <B>taylor</B> distribution.
<P>
We first ask <B>taylor</B> to generate
a integrator and a header file for us. 
<PRE>   taylor -o lorenz.c -jet -step -name lorenz lorenz.eq1
   taylor -o taylor.h -header</PRE>
The first command will produce a file <code>lorenz.c</code>
with no driving routine in it.  This file will be
compiled and linked with our main driving routine.
The second command generates the header file
<code>taylor.h</code>. It is needed in <code>lorenz.c</code> and
our main driving function.
<P>
<B>Using the Supplied Integrator</B>
<P>
Our first example is very similar to the 
driving routine generated by <B>taylor</B>.
It uses the one step integrator provided by
<B>taylor</B>.
<P>
<PRE>/* save as main1.c */

#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
#include &quot;taylor.h&quot;
int main(int argc, char **argv)
{
   MY_FLOAT  xx[3], t;
   double    h, abs_err, rel_err, h_return, log10abs_err;
   double    log10rel_err, endtime;
   int       nsteps = 100, step_ctrl_method = 2, direction = 1;
   int       order = 10;
   /* set initial conditions */
   xx[0] = 0.1;
   xx[1] = 0.2;
   xx[2] = 0.3;
   t     = 0.0;
   /* control parameters       */
   h= 0.001;
   abs_err = 1.0e-16;
   rel_err = 1.0e-16;
   log10abs_err = log10(abs_err); 
   log10rel_err = log10(rel_err); 
   endtime = 10.0;

   /* integrate 100 steps */
   while( -- nsteps &gt; 0 &amp;&amp; h_return != 0) {
      /* do something with xx and t. We just print it */
      printf(&quot;%f %f %f %f\n&quot;, xx[0],xx[1],xx[2],t);
      taylor_step_lorenz(&amp;t, &amp;xx[0], direction,
              step_ctrl_method,log10abs_err, log10rel_err, 
                         &amp;endtime, &amp;h_return, &amp;order);
   }
}</PRE>
<P>
After saving the code in <code>main1.c</code>, you can compile
them using the command
<PRE>   gcc lorenz.c main1.c -lm</PRE>
and run the executable <code>a.out</code> as before.
<P>
<B>Write Your Own Driver</B>
<P>
This example provides a skeleton for
writing your own one step integrator.
<P>
<PRE>/* save as main2.c */

#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
#include &quot;taylor.h&quot;

MY_FLOAT **taylor_coefficients_lorenz(MY_FLOAT, MY_FLOAT *, int);

int main(int argc, char **argv)
{
   MY_FLOAT  xx[3], tmp[3], t, **coef;
   int       j, order=20, nsteps = 100;
   double    step_size;
   /* set initiaial conditions */
   xx[0] = 0.1;
   xx[1] = 0.2;
   xx[2] = 0.3;
   t     = 0.0;
   /* control parameters       */
   step_size= 0.1;

   /* integrate 100 steps */
   while( -- nsteps &gt; 0) {
      /* do something with xx and t. We just print it */
      printf(&quot;%f %f %f %f\n&quot;, xx[0], xx[1], xx[2], t);

      /* compute the taylor coefficients */
      coef = taylor_coefficients_lorenz(t, xx, order);

      /* now we have the taylor coefficients in coef,
       * we can analyze them and choose a best step size.
       * Here we just integrate use the given stepsize.
       */

       tmp[0] = tmp[1] = tmp[2] = 0.0;
       for(j=order; j&gt;0; j--) /* sum up the taylor polynomial */
         { 
           tmp[0] = (tmp[0] + coef[0][j])* step_size;
           tmp[1] = (tmp[1] + coef[1][j])* step_size;
           tmp[2] = (tmp[2] + coef[2][j])* step_size;
         }
        /* advance one step */
        xx[0] = xx[0] + tmp[0];
        xx[1] = xx[1] + tmp[1];
        xx[2] = xx[2] + tmp[2];
        t += step_size; /* advance time */
     }
}</PRE>
<P>
<BR> <HR>
<P><ADDRESS>
<I>Maorong Zou <BR>
Tue Nov 13 09:42:48 CST 2001</I>
</ADDRESS>
</BODY>
</HTML>
